当我们为客户生产产品时，总价由两大部分组成：

1. **模具费用**：制作模具本身的费用
2. **产品费用**：使用该模具批量生产客户所需产品的费用

我们需要根据客户要求的产品数量(Q)来选择合适的“穴数”（即模具中同时生产多个产品的数量），从而达到总费用的最优（最低）状态。

### 一、模具费用的计算

**1. 模具成本**：

* 模具体积（V）是一个变量，它取决于模具的长度、宽度和高度（即模具尺寸会随着穴数增加而变化）。
* 模具材料有固定的密度（一个已知常数）和单位价格（已知常数）
  **公式：**
```
模具材料成本 = 模具体积 × 模具材料密度 × 模具材料单价
```

**2. 额外加工费**：在制作模具时的特殊加工成本，可以视为一个由材料或工序决定的函数。简单理解为：有些材质或设计更复杂，要额外付出一些加工费。

**3. 模具利润**：为了盈利，在成本基础上加上利润（利润比例是一个已知常数 r\_m），在一吨以上和一吨以下，此常量不同。
  **公式：**

```
模具售价 = (模具材料成本 + 额外加工费) × (1 + 利润系数)
```

### 二、产品费用的计算

**1. 产品材料成本**：

* 每件产品有自己的净体积(称为产品净体积)，材料密度和材料单价都是常数。\
  **公式：**

```
单件产品成本 = 产品净体积 × 产品材料密度 × 产品材料单价
```

* 客户需要 Q 件产品，因此：

```
总产品材料成本 = Q × (单件产品成本)
```

**2. 材料损耗**：

* 生产中材料不会百分之百利用，有损耗。
* 损耗比例（如5%或10%）是已知常数。\
  **公式：**

```
总损耗费用 = 总产品材料成本 × 损耗系数
```

**3. 加工费用（与机器吨位相关）**：

* 要选择合适的注塑机来生产，每台机有一个“吨位”标准。机器吨位越大，使用成本越高。
* 模具的大小（主要看宽度，高度和注胶总量）决定你需要多大的机器。
* 注胶总量 = (单件产品净体积 × 产品密度 × 穴数) / (某个转换系数)\
  简化理解：穴数越多，总一次性注胶量越大，可能需要更大吨位的机器。
* 当确定了机器吨位，就能确定该机每一次注塑（称为“一模”或“1模次”）的加工成本。

**4. 生产模次**：

* 穴数越多，一次出模的产品数量越多，满足Q件需求需要的出模次数就越少。
* 模次 = 向上取整(Q / 穴数)\
  **公式：**

```
总加工成本 = 模次 ×（单次模次成本）(单次模次成本取决于机器吨位)
```

**5. 产品利润**：

* 同样，为了盈利，在产品生产的总成本基础上加利润。\
  **公式：**

```
产品总售价 = (总产品材料成本 + 总损耗费用 + 总加工成本) × (1 + 产品利润系数)
```

### 三、总费用

最终给客户的总价格是：

```
总费用 = 模具售价 + 产品总售价
```

### 四、寻找最优穴数

* 穴数是个整数，从1开始增加，当穴数很小，模次过多，加工费很大；穴数过大，模具太贵、机器要求太高也不划算。
* 因此，我们需要在一定范围内尝试不同的穴数，计算出每个穴数下的总费用，然后从中选择最低的那个穴数。这个过程叫“离散枚举”。
* 尽管可以从1枚举到2100(30*70),但也可以用一些方法（如先大概范围估计、使用三分搜索或其他技巧）减少试算次数。
* 同时，因为不太可能需要枚举2099，实际只要枚举(n*m,n*m都是整数，且n<m，n不小于1，m不大于2100)就可以了。

### 五、限制条件对穴数的影响：

1. 机器最大吨位限制：超过一定模具尺寸或注胶量，就需要更大机器。若现有机器达不到，就不能提高穴数。
2. 模具腔之间的距离要求：穴数越多，排布越紧密，但要保持合理间距。
3. 产品净体积和模具设计：产品本身的大小影响单穴占用的空间。

## 计划中的代码结构

src/
└── lib/
    └── quote-price/
        ├── index.ts                  # quote-price模块的入口文件，可汇总和导出各子模块的函数
        ├── mold/
        │   ├── index.ts              # 汇总模具相关函数的入口
        │   ├── cost.ts               # 计算模具成本的逻辑 (calculateMoldCost)
        │   ├── dimensions.ts         # 与模具尺寸相关的计算和数据
        │   ├── materials/
        │   │   ├── index.ts          # 汇总材料相关逻辑
        │   │   └── material-types.ts # 定义材料类型、密度、价格等数据
        │   └── profit.ts             # 根据模具成本计算利润和最终售价的逻辑
        ├── product/
        │   ├── index.ts              # 汇总产品相关的函数
        │   ├── cost.ts               # 计算单件产品材料成本和总成本
        │   ├── volume.ts             # 计算产品净体积或包络体积的逻辑
        │   └── waste.ts              # 计算材料损耗相关的逻辑
        ├── machine/
        │   ├── index.ts              # 汇总机器相关函数入口
        │   ├── tonnage.ts            # 根据模具尺寸和穴数决定所需机器吨位
        │   ├── operation-cost.ts     # 根据机器吨位计算每模次的加工费用
        └── optimization/
            ├── index.ts              # 汇总优化方法
            ├── cavity-selection.ts   # 根据Q(数量)和成本函数通过离散枚举或其他优化算法选择最优穴数
            └── search-strategies.ts  # 三分搜索等搜索策略的实现

